{% extends "base.html" %}
{% load static i18n booking_tags %}   <!-- ← important: load your custom tags -->

{% block title %}{% trans "Customer Portal" %}{% endblock title %}

{% block extra_css %}
<style>
    .c-section { margin-top: 5rem; }
    .notice-box {
        background-color: #f8f9fa;
        border-left: 4px solid #6c757d;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 0.25rem;
    }
</style>
{% endblock extra_css %}

{% block content %}
<section class="c-section">
    <div class="container">
        <h2 class="text-center mb-4">{% trans "Your Proposals and Bookings" %}</h2>

        <!-- Optional subtle hint (like admin notice, but softer) -->
        <div class="notice-box text-center">
            <small>{% trans "Showing only your own records — enter email or ID to search" %}</small>
        </div>

        <form method="get" class="mb-4">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="email" class="form-label">{% trans "Your Email" %}</label>
                    <input type="email" name="email" id="email" class="form-control" 
                           value="{{ email }}" placeholder="your@email.com" required>
                </div>
                <div class="col-md-4">
                    <label for="id" class="form-label">{% trans "Proposal / Booking ID" %}</label>
                    <input type="text" name="id" id="id" class="form-control" 
                           value="{{ id }}" placeholder="PROP123 or BK456">
                </div>
                <div class="col-md-4 align-self-end">
                    <button type="submit" class="btn btn-primary w-100">
                        {% trans "Search" %}
                    </button>
                </div>
            </div>
        </form>

        <!-- Status filter buttons – using same clean pattern as management view -->
        <div class="mb-4">
            <div class="d-flex flex-wrap gap-2">
                <a href="{% query_transform request 'status' 'all' %}"
                   class="btn btn-outline-primary btn-sm {% if current_status == 'all' %}active{% endif %}">
                    {% trans "All" %}
                </a>

                <a href="{% query_transform request 'status' 'PENDING_SUPPLIER' %}"
                   class="btn btn-warning btn-sm {% if current_status == 'PENDING_SUPPLIER' %}active{% endif %}">
                    {% trans "Pending Supplier" %}
                </a>

                <a href="{% query_transform request 'status' 'PENDING_INTERNAL' %}"
                   class="btn btn-warning btn-sm {% if current_status == 'PENDING_INTERNAL' %}active{% endif %}">
                    {% trans "Pending Internal" %}
                </a>

                <a href="{% query_transform request 'status' 'CONFIRMED' %}"
                   class="btn btn-info btn-sm {% if current_status == 'CONFIRMED' %}active{% endif %}">
                    {% trans "Confirmed" %}
                </a>

                <a href="{% query_transform request 'status' 'SUPPLIER_CONFIRMED' %}"
                   class="btn btn-info btn-sm {% if current_status == 'SUPPLIER_CONFIRMED' %}active{% endif %}">
                    {% trans "Supplier Confirmed" %}
                </a>

                <a href="{% query_transform request 'status' 'REJECTED' %}"
                   class="btn btn-outline-danger btn-sm {% if current_status == 'REJECTED' %}active{% endif %}">
                    {% trans "Rejected" %}
                </a>

                <a href="{% query_transform request 'status' 'PAID' %}"
                   class="btn btn-success btn-sm {% if current_status == 'PAID' %}active{% endif %}">
                    {% trans "Paid" %}
                </a>
            </div>
        </div>

        {% if proposals or bookings %}
            <h3 class="mt-5 mb-3">{% trans "Proposals" %}</h3>
            {% include "bookings/partials/proposal_list_customer.html" %}

            <h3 class="mt-5 mb-3">{% trans "Bookings" %}</h3>
            {% include "bookings/partials/booking_list_customer.html" %}
            <!-- 
                Recommendation: 
                If you still have the inline table here, consider moving it to a separate partial 
                like booking_list_customer.html for better maintainability
            -->

        {% elif email or id %}
            <div class="alert alert-info text-center mt-4">
                {% trans "No records found for your search." %}
            </div>
        {% else %}
            <div class="alert alert-secondary text-center mt-4">
                {% trans "Enter your email or ID above to view your proposals and bookings." %}
            </div>
        {% endif %}
    </div>
</section>
{% endblock content %}