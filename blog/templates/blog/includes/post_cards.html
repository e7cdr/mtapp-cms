{% load static i18n wagtailcore_tags wagtailimages_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/blog/post_cards.css' %}">
{% endblock extra_css %}

{% block content %}
<section class="post-container">
    <div class="post-wrapper">
        {% for post in posts %}
        <a href="{% pageurl post %}">
            <div class="post-card">
                <div class="post-image-overlay" aria-label="hidden"></div>

                {% if post.banner_image %}
                    {% image post.banner_image fill-800x600 format-webp webpquality-60 loading="lazy" class="post-cover" %}
                {% else %}
                    <img class="post-cover" height="" width="" src="{% static 'images/placeholder.jpg' %}" alt="">
                {% endif %}

                <div class="post-desc">
                    <p class="post-date">{{ post.date_published|date:"M d, Y" }}</p>
                    <div class="author-info">    
                        {% if post.owner.profile_picture %}
                            {% image post.owner.profile_picture fill-50x50 format-webp webpquality-50 loading="lazy" alt="{{ post.owner.get_full_name }}" class="author-pic" %}
                        {% else %}
                            {% comment %} <img src="{% static 'images/default-avatar.jpg' %}" height="25" width="25" alt="" class="author-pic"> {% endcomment %}
                        {% endif %}
                        <p class="author-name">{{ post.owner.get_full_name|default:"Milano Travel " }}</p>
                    </div>
                    <p class="post-title">{{ post.title }}</p>
                </div>
            </div>
        </a>
        {% empty %}
        <div class="text-center py-5 col-span-full">
            <p class="fs-3 text-muted">{% trans "No posts to show." %}</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock content %}
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger, SplitText);
        let tl = gsap.timeline({
            scrollTrigger: ".post-container",
            scrub: 1,
            start: "top top",
        });

        tl.from('.post-wrapper', {
            opacity: 0,
            scale: 0,
            duration: 0.6,
            ease: "power1.inOut",
        }).fromTo('.post-card', {
            opacity: 0,
            scale: 3,
            y: 300,
         }, {
            opacity: 1,
            scale: 1,
            duration: 0.3,
            y: 0,
            ease: "sine.out",
            stagger: {
                grid: 'auto',
                from: "start",
                each: 0.5,
            }
        }).to('.post-wrapper', {
            scale: 1.008,
            duration: 2,
            repeat: -1,
            yoyo: true,
            ease: "power1.inOut",
        });
        document.fonts.ready.then(() => {
            SplitText.create(".post-card", 
                {type: "words, chars",
                onSplit(self) {
                    tl.from(self.words, {
                        autoAlpha: 0,
                        scale: 5,
                        x: "random(-220, 600)",
                        y: "random(-420, 100)",
                        stagger: 0.05,
                        duration: 0.3,
                        ease: "power1.inOut",
                    }, 1.3
                    ).to(self.chars, {color: "rgba(245, 254, 213, 1)", x: -3, stagger: 0.08, repeat: -1, yoyo: true,
                        onComplete: () => self.revert()
                    });
                },
                });
            });
    });
</script>
{% endblock extra_js %}