{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags i18n %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/blog_index.css' %}">
{% endblock extra_css %}

{% block content %}

<!-- ENHANCED HERO SECTION -->
{% block cover_page %}
  {% for block in page.cover_page %}
    {% include_block block %}
  {% endfor %}
  {% endblock cover_page %}
  <div class="hero-scroll-hint">
    <span aria-label="hidden"></span>
  </div>
<div class="index-container">

  <!-- FILTER BAR (unchanged logic, better spacing) -->
  <div class="filters-wrapper">
    <div class="filters-scroll">
      <a href="{% pageurl page %}" 
         class="filter-badge {% if not selected_category and not selected_tag %}active{% endif %}">
        <span>{% trans "All posts" %}</span>
        <span class="count">{{ posts.paginator.count }}</span>
      </a>

      {% for cat in categories %}
        <a href="?category={{ cat.slug }}" 
           class="filter-badge {% if selected_category and selected_category.slug == cat.slug %}active{% endif %}">
          <span>{{ cat.name }}</span>
          <span class="count">{{ cat.count }}</span>
        </a>
      {% endfor %}

      {% for tag in popular_tags %}
        <a href="?tag={{ tag.slug }}" 
           class="filter-badge {% if selected_tag and selected_tag.slug == tag.slug %}active{% endif %}">
          <span>#{{ tag.name }}</span>
          <span class="count">{{ tag.num_times }}</span>
        </a>
      {% endfor %}

      {% if selected_category or selected_tag %}
        <a href="{% pageurl page %}" class="clear-filters">
          {% trans "Clear filters" %}
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Active filter indicator -->
  {% if selected_category or selected_tag %}
    <div class="active-filter-text">
      {% trans "Showing" %}:
      {% if selected_category %}<strong>{{ selected_category.name }}</strong>{% endif %}
      {% if selected_tag %}<strong>#{{ selected_tag.name }}</strong>{% endif %}
    </div>
  {% endif %}

  <!-- REUSABLE POST CARDS -->
  {% block post_cards %}
    {% include "blog/includes/post_cards.html" %}
  {% endblock post_cards %}

  <!-- PAGINATION -->
  {% if posts.has_other_pages %}
  <nav class="pagination-wrapper">
    <div class="pagination">
      {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}{% if selected_category %}&category={{ selected_category.slug }}{% endif %}{% if selected_tag %}&tag={{ selected_tag.slug }}{% endif %}"
           class="page-btn">Previous</a>
      {% endif %}

      <span class="page-info">
        {% blocktrans with current=posts.number total=posts.paginator.num_pages %}
        Page {{ current }} of {{ total }}
        {% endblocktrans %}
      </span>

      {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}{% if selected_category %}&category={{ selected_category.slug }}{% endif %}{% if selected_tag %}&tag={{ selected_tag.slug }}{% endif %}"
           class="page-btn">Next</a>
      {% endif %}
    </div>
  </nav>
  {% endif %}

</div>
{% endblock content %}